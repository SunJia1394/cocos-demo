{"version":3,"sources":["file:///Users/sunjia/project/cocos-test/cocos-demo/extensions/live2d_cubismsdk_cocoscreator/static/assets/resources/Samples/LookAt/Billboarder.ts"],"names":["_decorator","Component","Camera","renderer","Vec3","ccclass","property","Billboarder","type","update","deltaTime","cameraToFace","worldPosition","node","cameraPos","rotation","cameraRot","up","transformQuat","UP","projection","scene","CameraProjection","ORTHO","forward","FORWARD","p","subtract","lookAt"],"mappings":";;;;;;;;;;;;;;;;AAOSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,I,OAAAA,I;;;;;;AAPlD;AACA;AACA;AACA;AACA;AACA;;;;;OAGM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;6BAGjBO,W,WADZF,OAAO,CAAC,aAAD,C,UAKLC,QAAQ,CAAC;AAAEE,QAAAA,IAAI,EAAEN;AAAR,OAAD,C,2BALX,MACaK,WADb,SACiCN,SADjC,CAC2C;AAAA;AAAA;;AACzC;AACF;AACA;AAH2C;AAAA;;AAOzC;AACF;AACA;AACA;AACA;AACSQ,QAAAA,MAAM,CAACC,SAAD,EAAoB;AAC/B,cAAI,KAAKC,YAAL,IAAqB,IAAzB,EAA+B;AAC7B;AACD;;AACD,gBAAM;AAAEC,YAAAA;AAAF,cAAoB,KAAKC,IAA/B;AACA,gBAAM;AAAED,YAAAA,aAAa,EAAEE,SAAjB;AAA4BC,YAAAA,QAAQ,EAAEC;AAAtC,cAAoD,KAAKL,YAAL,CAAkBE,IAA5E;AACA,gBAAMI,EAAE,GAAGb,IAAI,CAACc,aAAL,CAAmB,IAAId,IAAJ,EAAnB,EAA+BA,IAAI,CAACe,EAApC,EAAwCH,SAAxC,CAAX;;AACA,cAAI,KAAKL,YAAL,CAAkBS,UAAlB,IAAgCjB,QAAQ,CAACkB,KAAT,CAAeC,gBAAf,CAAgCC,KAApE,EAA2E;AACzE,kBAAMC,OAAO,GAAGpB,IAAI,CAACc,aAAL,CAAmB,IAAId,IAAJ,EAAnB,EAA+BA,IAAI,CAACqB,OAApC,EAA6CT,SAA7C,CAAhB;AACA,kBAAMU,CAAC,GAAGtB,IAAI,CAACuB,QAAL,CAAc,IAAIvB,IAAJ,EAAd,EAA0BQ,aAA1B,EAAyCY,OAAzC,CAAV;AACA,iBAAKX,IAAL,CAAUe,MAAV,CAAiBF,CAAjB,EAAoBT,EAApB;AACD,WAJD,MAIO;AACL,iBAAKJ,IAAL,CAAUe,MAAV,CAAiBd,SAAjB,EAA4BG,EAA5B;AACD;AACF;;AA1BwC,O;;;;;iBAKJ,I","sourcesContent":["/**\r\n * Copyright(c) Live2D Inc. All rights reserved.\r\n *\r\n * Use of this source code is governed by the Live2D Open Software license\r\n * that can be found at https://www.live2d.com/eula/live2d-open-software-license-agreement_en.html.\r\n */\r\n\r\nimport { _decorator, Component, Camera, renderer, Vec3 } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Billboarder')\r\nexport class Billboarder extends Component {\r\n  /**\r\n   * Camera to face.\r\n   */\r\n  @property({ type: Camera })\r\n  public cameraToFace: Camera | null = null;\r\n\r\n  /**\r\n   * Called by Cocos Creator. Updates facing.\r\n   * @param deltaTime\r\n   * @returns\r\n   */\r\n  public update(deltaTime: number) {\r\n    if (this.cameraToFace == null) {\r\n      return;\r\n    }\r\n    const { worldPosition } = this.node;\r\n    const { worldPosition: cameraPos, rotation: cameraRot } = this.cameraToFace.node;\r\n    const up = Vec3.transformQuat(new Vec3(), Vec3.UP, cameraRot);\r\n    if (this.cameraToFace.projection == renderer.scene.CameraProjection.ORTHO) {\r\n      const forward = Vec3.transformQuat(new Vec3(), Vec3.FORWARD, cameraRot);\r\n      const p = Vec3.subtract(new Vec3(), worldPosition, forward);\r\n      this.node.lookAt(p, up);\r\n    } else {\r\n      this.node.lookAt(cameraPos, up);\r\n    }\r\n  }\r\n}\r\n"]}